USE MASTER 
GO 
IF DB_ID('QL') IS NOT NULL
	DROP DATABASE QL
GO
CREATE DATABASE QL
GO
USE QL
GO


CREATE TABLE SINHVIEN
(
	MASV CHAR (10) NOT NULL,
	HOTEN NVARCHAR (50) NOT NULL,
	PHAI NVARCHAR (5) NOT NULL,
	NGAYSINH DATE NOT NULL,
	DCHI NVARCHAR (50) NOT NULL,
	MANGANH CHAR (10)NOT NULL

	CONSTRAINT PK_SINHVIEN
	PRIMARY KEY (MASV)
)


CREATE TABLE NGANH
(
	MANGANH CHAR (10),
	TENNGANH NVARCHAR (50),
	SOCD INT,
	TSSV INT

	CONSTRAINT PK_NGANH
	PRIMARY KEY (MANGANH)
)


CREATE TABLE CHUYENDE
(
	MACD CHAR(10),
	TENCD NVARCHAR (50),
	SOSVTD INT 

	CONSTRAINT PK_CHUYENDE
	PRIMARY KEY (MACD)
)


CREATE TABLE CD_NGANH 
(
	MACD CHAR(10),
	MANGANH CHAR (10)

	CONSTRAINT PK_CD_NGANH
	PRIMARY KEY (MACD,MANGANH)
)


CREATE TABLE CD_MO
(
	MACD CHAR(10),
	HOCKY INT,
	NAM INT

	CONSTRAINT PK_CD_MO
	PRIMARY KEY (MACD,HOCKY)
)

CREATE TABLE DANGKY
(
	MASV CHAR(10),
	MACD CHAR (10),
	HOCKY INT,
	NAM INT,
	DIEM FLOAT 

	CONSTRAINT PK_DANGKY
	PRIMARY KEY (MASV,MACD,HOCKY)
)

--DK -> SV
--DK-> CD
--DK -> CD_MO
ALTER TABLE DANGKY
ADD 
	CONSTRAINT FK_DK_SV
	FOREIGN KEY(MASV)
	REFERENCES SINHVIEN,

	CONSTRAINT FK_DK_CD
	FOREIGN KEY(MACD)
	REFERENCES CHUYENDE,

	CONSTRAINT FK_DK_CD_MO
	FOREIGN KEY(MACD,HOCKY)
	REFERENCES CD_MO

--CD-NGANH -> NGANH 
--CD-NGANH ->CHUYENDE

ALTER TABLE CD_NGANH 
ADD 
	CONSTRAINT FK_CD_NGANH_NGANH
	FOREIGN KEY(MANGANH)
	REFERENCES NGANH ,

	CONSTRAINT FK_CD_NGANH_CHUYENDE 
	FOREIGN KEY (MACD)
	REFERENCES CHUYENDE


--SV-> NGANH

ALTER TABLE SINHVIEN
ADD 
	CONSTRAINT FK_SV_NGANH 
	FOREIGN KEY (MASV)
	REFERENCES NGANH 